#!/bin/bash
# shellcheck disable=SC2034,SC2164
# Maintainer: Alexandre Bouvier <contact at amb dot tf>
_pkgname=arduino
pkgname="$_pkgname-nox"
pkgver=1.6.10
pkgrel=1
pkgdesc="Arduino prototyping platform SDK (headless version, without IDE)"
arch=('any')
url="https://www.arduino.cc/"
license=('GPL' 'LGPL')
depends=('avr-libc' 'avrdude' 'shared-mime-info' 'gtk-update-icon-cache')
optdepends=('arduino-mk: Makefile for Arduino sketches')
provides=("$_pkgname=$pkgver")
conflicts=("$_pkgname" 'teensyduino')
options=(!strip)
install="$_pkgname.install"
source=("https://github.com/arduino/Arduino/archive/$pkgver.tar.gz")
md5sums=('570846aed89f2f87f442c0851ee7e823')

prepare() {
	cd "Arduino-$pkgver"
	ln -s build/shared/examples
}

package() {
	cd "Arduino-$pkgver"
	# shellcheck disable=SC2154
	find libraries -type f -exec install -Dm644 {,"$pkgdir/usr/share/$_pkgname/"}{} \;
	find hardware/arduino/avr -type f -exec install -Dm644 {,"$pkgdir/usr/share/$_pkgname/"}{} \;
	install -Dm644 build/linux/dist/mime.xml "$pkgdir/usr/share/mime/packages/$_pkgname.xml"
	find examples/ -type f -exec install -Dm644 {,"$pkgdir/usr/share/doc/$_pkgname/"}{} \;
	install -Dm644 -t "$pkgdir/usr/share/doc/$_pkgname" build/shared/revisions.txt
	for size in 16 24 32 48 64 72 96 128 256 ; do
		install -Dm644 "build/shared/icons/${size}x$size/apps/arduino.png" \
			"$pkgdir/usr/share/icons/hicolor/${size}x$size/mimetypes/text-x-arduino.png"
	done
	# used by arduino-mk
	install -Dm644 <(echo -n "$pkgver") "$pkgdir/usr/share/$_pkgname/lib/version.txt"
}
